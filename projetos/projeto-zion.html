<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matheus Silva | Zion</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="projeto-style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
</head>
<body class="pagina-projeto">

    <header class="header">
        <nav class="navbar container">
            <a href="../index.html" class="logo gradient-text">Matheus Silva</a>
            <ul class="nav-menu">
                <li class="nav-item"><a href="../index.html#sobre" class="nav-link">Sobre</a></li>
                <li class="nav-item"><a href="../index.html#formacao" class="nav-link">Formação</a></li>
                <li class="nav-item"><a href="../index.html#projetos" class="nav-link">Projetos</a></li>
                <li class="nav-item"><a href="../index.html#contato" class="nav-link">Contato</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>

    <main>
        <section class="projeto-hero gsap-fade-in">
            <div class="container">
                <span class="breadcrumb"><a href="../index.html#projetos">Projetos</a> /</span>
                <h1>Zion</h1>
                <p class="projeto-subtitulo">Aplicação desktop (PyQt5) para limpeza, validação e geração de relatórios de dados financeiros, com regras de negócio dinâmicas.</p>
            </div>
        </section>

        <div class="container gsap-fade-in">
             <img src="../assets/images/zion4.png" alt="Interface do Zion - Validador com INSS" class="projeto-imagem-destaque">
        </div>

        <section class="projeto-conteudo gsap-fade-in">
            <div class="container">
                
                <div class="projeto-descricao">
                    <h2>O Desafio</h2>
                    <p>Processar, limpar e validar dados financeiros de múltiplos convênios (INSS, Zetra, Consiglog, etc.) é um processo manual, lento e suscetível a erros. Cada convênio possui arquivos com layouts diferentes, regras de negócio distintas e nomes de colunas inconsistentes.</p>
                    <p>Era necessário criar uma ferramenta centralizada que pudesse não apenas limpar esses arquivos de forma inteligente, mas também validá-los de forma robusta contra um banco de dados, aplicando regras de negócio complexas via SQL.</p>

                    <h2>A Solução: Aplicação Desktop Zion</h2>
                    <p>Desenvolvi o "Zion", uma aplicação desktop completa em Python (PyQt5) que unifica o fluxo de tratamento de dados financeiros em duas abas principais:</p>
                    <ul class="lista-detalhada">
                        <li><strong>Interface Gráfica (PyQt5):</strong> Design moderno e intuitivo dividido em "Limpeza de Planilhas" e "Validador de Convênios".</li>
                        <li><strong>Módulo de Limpeza Dinâmico:</strong> Permite ao usuário selecionar um tipo de limpeza (ex: "Orbital"). A aplicação então usa um dicionário de regras (`regras_limpeza.py`) para aplicar transformações específicas.</li>
                        <li><strong>Módulo de Validação (SQL):</strong> O usuário seleciona um convênio (ex: "INSS") e a interface exibe dinamicamente os arquivos necessários para o upload, com base no `configuracoes.py`.</li>
                        <li><strong>Processamento em Banco (ETL):</strong> A aplicação carrega os arquivos CSV/Excel para tabelas em um banco de dados PostgreSQL, usando schemas pré-definidos (`criacao_tabelas.py`) ou gerando-os dinamicamente.</li>
                        <li><strong>Execução de Regras de Negócio:</strong> Após o carregamento, o Zion executa scripts SQL transacionais específicos para cada convênio (`validacao_base.py`), realizando as validações e cálculos complexos.</li>
                        <li><strong>Configuração Segura:</strong> Inclui um modal de configurações onde o usuário pode definir e testar os parâmetros de conexão (Host, Porta, DB, Usuário, Senha).</li>
                    </ul>

                    <h2>Interface da Aplicação</h2>
                    <p>Visualização das principais funcionalidades do Zion.</p>
                    <div class="galeria-grid galeria-4-colunas">
                        <figure>
                            <img src="../assets/images/zion1.png" alt="Aba Limpeza de Planilhas - Inicial">
                            <figcaption>Aba "Limpeza de Planilhas".</figcaption>
                        </figure>
                        <figure>
                            <img src="../assets/images/zion3.png" alt="Aba Limpeza com tipo selecionado">
                            <figcaption>Limpeza configurada para "Orbital".</figcaption>
                        </figure>
                        <figure>
                            <img src="../assets/images/zion2.png" alt="Aba Validador de Convênios - Inicial">
                            <figcaption>Aba "Validador de Convênios".</figcaption>
                        </figure>
                        <figure>
                            <img src="../assets/images/zion5.png" alt="Configurações do Banco de Dados">
                            <figcaption>Modal de Configurações do DB.</figcaption>
                        </figure>
                    </div>

                    <h2>Código em Destaque</h2>
                    <p>Trecho do `validacao_base.py` que orquestra o processo de validação. Ele demonstra como o sistema busca as configurações de conexão, se conecta ao banco (Psycopg2), importa os dados e executa os scripts SQL em etapas transacionais (commit/rollback).</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <i data-feather="file-text"></i>
                            <span>validacao_base.py (Orquestrador)</span>
                        </div>
<pre><code class="language-python">
import psycopg2
from psycopg2 import sql
from design.settings_manager import get_db_config

def run_validation_process(
    convenio,
    file_paths,
    output_path,
    progress_callback=None,
    **kwargs
):
    conn = None
    try:
        if progress_callback:
            progress_callback.emit(5, "Conectando...")

        current_db_config = get_db_config()
        conn = psycopg2.connect(**current_db_config)
        cur = conn.cursor()

        for i, (table_name, file_path) in enumerate(file_paths.items()):
            progress = 10 + int((i / len(file_paths)) * 65)
            if progress_callback:
                progress_callback.emit(progress, f"Importando '{table_name}'...")
            import_csv_to_postgres(conn, cur, table_name, file_path, convenio)

        if progress_callback:
            progress_callback.emit(75, "Executando script principal...")

        conn.autocommit = False
        cur.execute("BEGIN;")

        try:
            for i, step in enumerate(steps):
                if progress_callback:
                    progress_callback.emit(step_progress, f"SQL: {step['name']}...")
                
                if step['sql'].strip():
                     cur.execute(step['sql'])

            conn.commit()
            print("Script SQL executado com sucesso.")

        except Exception as e_sql:
             conn.rollback()
             raise Exception(f"Erro na etapa SQL '{step['name']}':\n{e_sql}")

        finally:
            conn.autocommit = True
        
    except psycopg2.Error as e:
        if conn:
            conn.rollback()
        if "password authentication failed" in str(e):
             raise Exception("Erro de Banco de Dados: Autenticação falhou.")
    
    finally:
        if conn:
            cur.close()
            conn.close()
</code></pre>
                    </div> 
                </div> 
                 
            </div> 
        </section> 
    </main>

    <footer class="footer">
        <div class="container">
            <p>© 2025 Matheus Silva. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    
    <script src="../script.js"></script>
    <script src="projeto-script.js"></script>
    
    <script>
        feather.replace();
    </script>
    
</body>
</html>